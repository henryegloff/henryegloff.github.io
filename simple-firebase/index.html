<!DOCTYPE html>
<html>
<head>
	<title>Simple Firebase Starter</title>
	<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>

	<style>

		body {
			background-color: #eee;
		}

		#item-list {
			list-style: none;
			padding:0;
		}

		#item-list li {
			background-color: #fff;
			width: 240px;
			margin-bottom: 10px;
			padding: 10px 20px;
		}

		#item-list div {
			border: 1px solid #eee;
			cursor: pointer;
			display: inline-block;
			padding: 5px;
			background-color: #eee;
		}

		input {
			display: block;
			margin-bottom: 10px;
		}

	</style>

</head>
<body>


	<h2>Items:</h2>

	<form id="add-item-form">
		
		<input type="text" name="name" placeholder ="Item Name"> 

		<select name="type">
		  <option value="Free">Free</option>
		  <option value="For Sale">For Sale</option>
		  <option value="Exchange">Exchange</option>
		</select>

		<button>Add Item</button>

	</form>

	<ul id ="item-list"></ul>




	<script>

  var firebaseConfig = {
  	apiKey: "AIzaSyCNQHxTzOW41eiQaWq48TiDahwS7a5oNH4",
  	authDomain: "simple-firebase-starter.firebaseapp.com",
  	databaseURL: "https://simple-firebase-starter.firebaseio.com",
  	projectId: "simple-firebase-starter",
  	storageBucket: "simple-firebase-starter.appspot.com",
  	messagingSenderId: "379279403976",
  	appId: "1:379279403976:web:6687712d66d308364e2efd"
  };


  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  const db = firebase.firestore();

  const itemList = document.querySelector('#item-list');
  const form = document.querySelector('#add-item-form');

  // Create elements and render items

  function renderItem(doc) {
  	let li = document.createElement('li');
  	let name = document.createElement('h3');
  	let type = document.createElement('h4');
  	let cross = document.createElement('div');

  	li.setAttribute('id', doc.id);
  	name.textContent = doc.data().name;
  	type.textContent = doc.data().type;
  	cross.textContent = 'delete';

  	li.appendChild(name);
  	li.appendChild(type);
  	li.appendChild(cross);

  	itemList.appendChild(li);

  	 // Deleting Data

	  cross.addEventListener('click', (e) => {
	  	e.stopPropagation();
	  	let id = e.target.parentElement.getAttribute('id');
	  	db.collection('items').doc(id).delete();
	  })



  }

  // Getting Data - Initial Static Method

  /*
  db.collection('items').get().then((snapshot) => {

  	snapshot.docs.forEach(doc => {
  		console.log(doc.data());
  		renderItem(doc);
  	})

  })
  */


  // Saving Data 

  form.addEventListener('submit', (e) => {
  	e.preventDefault();
  	db.collection('items').add({
  		name: form.name.value,
  		type: form.type.value
  	});
  	form.name.value = '';
  	form.type.value = '';
  })


  // Real Time Listener

  db.collection('items').orderBy('name').onSnapshot(snapshot => {
  	let changes = snapshot.docChanges();

  	changes.forEach(change => {
  		if(change.type == 'added'){
  			renderItem(change.doc);
  		} else if (change.type == 'removed'){
  			let li = itemList.querySelector('[id=' + change.doc.id + ']');
  			itemList.removeChild(li);
  		}
  	})


  	//console.log(changes);
  })


 


</script>



</body>
</html>
